#!/usr/bin/env bash

set -o errexit
set -o pipefail
set -o nounset

xdg_variables() {
    if [ ! -e "/etc/profile.d/xdg.sh" ]; then
        echo 'Setting up XDG environement variables...'
        sudo ln -s "$HOME/.config/zsh/xdg.sh" "/etc/profile.d/xdg.sh"
        echo 'Done.'
    fi
}

fzf() {
    if [ ! -e "$HOME/.config/nvim/after/plugin/fzf.vim" ]; then
        echo 'Creating symbolic link to fzf.vim in ~/.config/nvim/after/plugin...'
        ln -s "/usr/share/vim/vimfiles/plugin/fzf.vim" "$HOME/.config/nvim/after/plugin/fzf.vim"
        echo 'Done.'
    fi
}

neovim_package_manager() {
    if [ ! -d "$HOME/.local/share/nvim/site/pack/packer/opt/packer.nvim" ]; then
        echo 'Installing a package manager for Neovim...'
        git clone "https://github.com/wbthomason/packer.nvim" "$HOME/.local/share/nvim/site/pack/packer/opt/packer.nvim"
        echo 'Done.'
    fi
}

neovim_packages() {
    nvim -u NONE +'lua require"my.config.packages".install()'
}

main() {
    xdg_variables
    fzf
    neovim_package_manager
    neovim_packages
    exit 0
}

main
